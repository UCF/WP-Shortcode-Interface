{"version":3,"sources":["wp-scif.ts"],"names":["WPSCIF","ShortcodeInterface","_this","this","$toggle","jQuery","$submitBtn","$select","selectedShortcode","$fields","click","e","resetForm","onSubmitBtnClick","change","onSelectChanged","prototype","editor","tinyMCE","activeEditor","val","trigger","prop","each","i","field","$field","validateForm","errors","name","data","addClass","removeClass","getFormValues","command","params","param","value","hasClass","String","insertShortcode","enclosingText","selection","getContent","text","key","send_to_editor","preventDefault","shortcode","find","document","ready"],"mappings":"AAGA,GAAUA,SAAV,SAAUA,GACN,GAAAC,GAAA,WAQI,QAAAA,KAAA,GAAAC,GAAAC,IACIA,MAAKC,QAAUC,OAAO,kBACtBF,KAAKG,WAAaD,OAAO,mBACzBF,KAAKI,QAAUF,OAAO,mBACtBF,KAAKK,kBAAoB,KACzBL,KAAKM,QAAUJ,OAAO,kBAEtBF,KAAKC,QAAQM,MAAO,SAACC,GAAQT,EAAKU,cAClCT,KAAKG,WAAWI,MAAO,SAACC,GAAQT,EAAKW,iBAAiBF,KACtDR,KAAKI,QAAQO,OAAQ,SAACH,GAAQT,EAAKa,gBAAgBJ,KA4H3D,MAzHIV,GAAAe,UAAAJ,UAAA,WACIT,KAAKc,OAASC,QAAQC,aAAeD,QAAQC,aAAe,KAC5DhB,KAAKI,QAAQa,IAAI,IAAIC,QAAQ,UAC7BlB,KAAKM,QAAQa,KAAK,WAAW,GAC7BnB,KAAKM,QAAQc,KAAM,SAACC,EAAGC,GACnB,GAAIC,GAASrB,OAAOoB,EACS,cAAxBC,EAAOJ,KAAW,MACnBI,EAAON,IAAI,OAKvBnB,EAAAe,UAAAW,aAAA,WACI,GAAIC,GAAS,CAcb,OAbAzB,MAAKM,QAAQc,KAAM,SAACC,EAAGC,GACnB,GAAIC,GAASrB,OAAOoB,GAChBI,EAAOH,EAAOI,KAAK,aACRJ,GAAOI,KAAK,kBAES,KAAjBJ,EAAON,OACtBf,OAAQ,IAAMwB,EAAO,UAAWE,SAAS,UACzCH,KAEAvB,OAAQ,IAAMwB,EAAO,UAAWG,YAAY,aAI/CJ,GAOT3B,EAAAe,UAAAiB,cAAA,WACI,GAAIH,IACAI,QAAS/B,KAAKK,kBACd2B,UAGJhC,MAAKM,QAAQc,KAAM,SAACC,EAAGC,GACnB,GAAIC,GAASrB,OAAOoB,GAChBW,EAASV,EAAOI,KAAK,cACrBO,EAAS,EAEb,QAAQX,EAAOJ,KAAK,YAChB,IAAK,QACL,IAAK,WACL,IAAK,SACD,GAA4B,aAAxBI,EAAOJ,KAAK,QACZ,GAAKI,EAAOY,SAAU,sBAAyB,CAC3C,IAAKZ,EAAOJ,KAAK,WAGb,KAFAe,GAAQX,EAAON,UAKnBiB,GAAQE,OAAOb,EAAOJ,KAAK,gBAG/Be,GAAQX,EAAON,KAEnB,MACJ,SACIiB,EAAQX,EAAON,MAGnBiB,QACkC,KAAvBP,EAAKK,OAAOC,GACnBN,EAAKK,OAAOC,IAAU,IAAMC,EAE5BP,EAAKK,OAAOC,GAASC,KAKjClC,KAAKqC,gBAAgBV,IAGzB7B,EAAAe,UAAAwB,gBAAA,SAAgBV,GACZ,GAAIW,GAAgB,IAEftC,MAAKc,SACNwB,EAAgBtC,KAAKc,OAAOyB,UAAUC,aAG1C,IAAIC,GAAO,IAAMd,EAAKI,OAEtB,IAAIJ,EAAKK,OACL,IAAK,GAAIU,KAAOf,GAAKK,OACjBS,GAAQ,IAAMC,EAAM,KAAOf,EAAKK,OAAOU,GAAO,GAItDD,IAAQ,IAEHH,IACDG,GAAQH,EAAgB,KAAOX,EAAKI,QAAU,KAGlDY,eAAgBF,IAGpB3C,EAAAe,UAAAH,iBAAA,SAAiBF,GACbA,EAAEoC,gBACF,IAAIC,GAAY7C,KAAKI,QAAQa,KAEff,QAAO,cAAgB2C,GAAWC,KAAK,iBAEhD9C,MAAKwB,gBACNxB,KAAK8B,iBAIbhC,EAAAe,UAAAD,gBAAA,SAAgBJ,GACZR,KAAKK,kBAAoBL,KAAKI,QAAQa,MAEtCf,OAAO,+BAA+B2B,YAAY,UAElD3B,OAAO,cAAgBF,KAAKK,mBAAmBuB,SAAS,WAEhE9B,IA7IaD,GAAAC,mBAAkBA,GADzBD,SAAAA,YAiJa,mBAAXK,SACRA,OAAO6C,UAAUC,MAAO,WACpB,GAAInD,QAAOC","file":"wp-scif.min.js","sourcesContent":["declare var tinyMCE: any;\ndeclare var send_to_editor: Function;\n\nnamespace WPSCIF {\n    export class ShortcodeInterface {\n        public $toggle: any;\n        public $submitBtn: any;\n        public $select: any;\n        public selectedShortcode: string;\n        public $fields: any;\n        public editor: any;\n\n        constructor() {\n            this.$toggle = jQuery('#add-shortcode');\n            this.$submitBtn = jQuery('#wp-scif-submit');\n            this.$select = jQuery('#wp-scif-select');\n            this.selectedShortcode = null;\n            this.$fields = jQuery('.wp-scif-field');\n\n            this.$toggle.click( (e) => { this.resetForm() } );\n            this.$submitBtn.click( (e) => { this.onSubmitBtnClick(e) });\n            this.$select.change( (e) => { this.onSelectChanged(e) });\n        }\n\n        resetForm() {\n            this.editor = tinyMCE.activeEditor ? tinyMCE.activeEditor : null;\n            this.$select.val('').trigger('change');\n            this.$fields.prop('checked', false);\n            this.$fields.each( (i, field) => {\n                var $field = jQuery(field);\n                if ( $field.prop['type'] !== 'checkbox' ) {\n                    $field.val('');\n                }\n            });\n        }\n\n        validateForm() : boolean {\n            var errors = 0;\n            this.$fields.each( (i, field) => {\n                var $field = jQuery(field),\n                    name = $field.data('scif-param'),\n                    required = $field.data('scif-required');\n\n                if ( required && ( $field.val() === '' ) ) {\n                    jQuery( '.' + name + '-error' ).addClass('active');\n                    errors++;\n                } else {\n                    jQuery( '.' + name + '-error' ).removeClass('active');\n                }\n            });\n\n            if ( errors ) {\n                return false;\n            }\n\n            return true;\n        }\n\n        getFormValues() {\n            var data = {\n                command: this.selectedShortcode,\n                params: {}\n            };\n\n            this.$fields.each( (i, field) => {\n                var $field = jQuery(field),\n                    param  = $field.data('scif-param'),\n                    value  = '';\n\n                switch( $field.prop('tagName') ) {\n                    case 'INPUT':\n                    case 'TEXTAREA':\n                    case 'SELECT':\n                        if ($field.prop('type') === 'checkbox') {\n                            if ( $field.hasClass( 'checkbox-list-item' ) ) {\n                                if ( $field.prop('checked') ) {\n                                    value = $field.val();\n                                } else {\n                                    break;\n                                }\n                            } else {\n                                value = String($field.prop('checked'));\n                            }\n                        } else {\n                            value = $field.val();\n                        }\n                        break;\n                    default:\n                        value = $field.val();\n                }\n\n                if (value) {\n                    if (typeof data.params[param] !== 'undefined') {\n                        data.params[param] += ',' + value;\n                    } else {\n                        data.params[param] = value;\n                    }\n                }\n            });\n\n            this.insertShortcode(data);\n        }\n\n        insertShortcode(data) {\n            var enclosingText = null;\n\n            if ( this.editor ) {\n                enclosingText = this.editor.selection.getContent();\n            }\n\n            var text = '[' + data.command;\n\n            if (data.params) {\n                for (var key in data.params) {\n                    text += ' ' + key + '=\"' + data.params[key] + '\"';\n                }\n            }\n\n            text += ']';\n\n            if ( enclosingText ) {\n                text += enclosingText + '[/' + data.command + ']';\n            }\n\n            send_to_editor( text );\n        }\n\n        onSubmitBtnClick(e) {\n            e.preventDefault();\n            var shortcode = this.$select.val();\n\n            var $fields = jQuery('.shortcode-' + shortcode).find('.wp-scif-field');\n\n            if ( this.validateForm() ) {\n                this.getFormValues();\n            }\n        }\n\n        onSelectChanged(e) {\n            this.selectedShortcode = this.$select.val();\n\n            jQuery('#wp-scif-form-inner .active').removeClass('active');\n\n            jQuery('.shortcode-' + this.selectedShortcode).addClass('active');\n        }\n    }\n}\n\nif ( typeof jQuery !== 'undefined' ) {\n    jQuery(document).ready( function() {\n        new WPSCIF.ShortcodeInterface();\n    });\n}\n"]}