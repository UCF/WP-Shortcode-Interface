{"version":3,"sources":["field.ts","text.ts","select.ts","date.ts","fieldset.ts","wp-scif.ts"],"names":["WPSCIF","Fields","Field","$field","this","required","data","param","prototype","is_valid","get_value","val","get_output","TextField","_super","_this","call","inputMask","__extends","RegExp","test","SelectField","DateField","FieldSet","command","$container","jQuery","fields","Array","find","each","idx","obj","push","createField","tagName","prop","attr","getFields","ShortcodeInterface","$toggle","$submitBtn","$select","selectedShortcode","$fields","click","e","resetForm","onSubmitBtnClick","change","onSelectChanged","editor","tinyMCE","activeEditor","trigger","i","field","validateForm","errors","name","addClass","removeClass","parseShortcode","getFormValues","insertShortcode","params","value","hasClass","String","text","buildShortcode","send_to_editor","enclosingText","selection","getContent","key","preventDefault","shortcode","length","initPreview","window","frames","append","getJSON","ajaxurl","action","ifrm","document","getElementById","contentWindow","contentDocument","open","write","markup","close","ready"],"mappings":"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","file":"wp-scif.min.js","sourcesContent":["namespace WPSCIF.Fields {\n    export abstract class Field {\n        protected $field: any;\n        public required: boolean;\n        public param: string;\n\n        constructor($field: any) {\n            this.$field = $field;\n            this.required = <boolean>this.$field.data('scif-required');\n            if (typeof this.required === \"undefined\") {\n                this.required = false;\n            }\n            this.param = this.$field.data('scif-param');\n        }\n\n        public is_valid(): boolean {\n            // If required, it must have value\n            if (this.required && ! this.get_value()) {\n                return false;\n            }\n            return true;\n        }\n\n        public get_value() {\n            return this.$field.val();\n        }\n\n        public get_output() {\n            return this.param + '=\"' + this.get_value() + '\"';\n        }\n    }\n}\n","namespace WPSCIF.Fields {\n    export class TextField extends Field {\n        inputMask: string;\n\n        constructor($field: any) {\n            super($field);\n            this.inputMask = this.$field.data('wpscif-valid-regex');\n        }\n\n        public is_valid() : boolean {\n            var valid = super.is_valid();\n\n            var pattern = new RegExp(this.inputMask);\n            var valid = pattern.test(this.get_value());\n\n            return valid;\n        }\n    }\n}\n","namespace WPSCIF.Fields {\n    export class SelectField extends Field {\n        constructor($field: any) {\n            super($field)\n        }\n    }\n}\n","namespace WPSCIF.Fields {\n    export class DateField extends Field {\n        inputMask: string;\n\n        constructor($field: any) {\n            super($field);\n        }\n    }\n}\n","/// <reference path=\"./fields/fields.d.ts\" />\n\nnamespace WPSCIF {\n    export class FieldSet {\n        private command: string;\n        private fields: Array<Fields.Field>;\n        private $container: any;\n        \n        constructor(command) {\n            this.command = command;\n            this.$container = jQuery('.shortcode-editor.shortcode-' + command);\n            this.fields = new Array<Fields.Field>();\n            var $fields = this.$container.find('.wp-scif-field');\n\n            $fields.each( (idx, obj) => {\n                var $field = jQuery(obj);\n                this.fields.push(new Fields.TextField($field));\n            });\n        }\n\n        private createField(obj) {\n            var $field = jQuery(obj),\n                tagName = $field.prop('tagName');\n\n            if (tagName === 'SELECT') {\n                return new Fields.SelectField($field);\n            } else if (tagName === 'INPUT') {\n                var type = $field.attr('type');\n                switch(type) {\n                    case 'text':\n                        return new Fields.TextField($field);\n                    case 'date':\n                        return new Fields.DateField($field);\n                    default:\n                        return new Fields.TextField($field);\n                }\n            }\n        }\n\n        public getFields() {\n            return this.fields;\n        }\n    }\n}\n","/// <reference path=\"./wp-scif.d.ts\" />\n\ndeclare var tinyMCE: any;\ndeclare var send_to_editor: Function;\ndeclare var ajaxurl: string;\n\nnamespace WPSCIF {\n    export class ShortcodeInterface {\n        public $toggle: any;\n        public $submitBtn: any;\n        public $select: any;\n        public selectedShortcode: string;\n        public $fields: any;\n        public editor: any;\n\n        constructor() {\n            this.$toggle = jQuery('#add-shortcode');\n            this.$submitBtn = jQuery('#wp-scif-submit');\n            this.$select = jQuery('#wp-scif-select');\n            this.selectedShortcode = null;\n            this.$fields = jQuery('.wp-scif-field');\n\n            this.$toggle.click( (e) => { this.resetForm() } );\n            this.$submitBtn.click( (e) => { this.onSubmitBtnClick(e) });\n            this.$select.change( (e) => { this.onSelectChanged(e) });\n        }\n\n        resetForm() {\n            this.editor = tinyMCE.activeEditor ? tinyMCE.activeEditor : null;\n            this.$select.val('').trigger('change');\n            this.$fields.prop('checked', false);\n            this.$fields.each( (i, field) => {\n                var $field = jQuery(field);\n                if ( $field.prop['type'] !== 'checkbox' ) {\n                    $field.val('');\n                }\n            });\n        }\n\n        validateForm() : boolean {\n            var errors = 0;\n            this.$fields.each( (i, field) => {\n                var $field = jQuery(field),\n                    name = $field.data('scif-param'),\n                    required = $field.data('scif-required');\n\n                if ( required && ( $field.val() === '' ) ) {\n                    jQuery( '.' + name + '-error' ).addClass('active');\n                    errors++;\n                } else {\n                    jQuery( '.' + name + '-error' ).removeClass('active');\n                }\n            });\n\n            if ( errors ) {\n                return false;\n            }\n\n            return true;\n        }\n\n        parseShortcode() {\n            var data = this.getFormValues();\n            this.insertShortcode(data);\n        }\n\n        getFormValues() {\n            var data = {\n                command: this.selectedShortcode,\n                params: {}\n            };\n\n            this.$fields.each( (i, field) => {\n                var $field = jQuery(field),\n                    param  = $field.data('scif-param'),\n                    value  = '';\n\n                switch( $field.prop('tagName') ) {\n                    case 'INPUT':\n                    case 'TEXTAREA':\n                    case 'SELECT':\n                        if ($field.prop('type') === 'checkbox') {\n                            if ( $field.hasClass( 'checkbox-list-item' ) ) {\n                                if ( $field.prop('checked') ) {\n                                    value = $field.val();\n                                } else {\n                                    break;\n                                }\n                            } else {\n                                value = String($field.prop('checked'));\n                            }\n                        } else {\n                            value = $field.val();\n                        }\n                        break;\n                    default:\n                        value = $field.val();\n                }\n\n                if (value) {\n                    if (typeof data.params[param] !== 'undefined') {\n                        data.params[param] += ',' + value;\n                    } else {\n                        data.params[param] = value;\n                    }\n                }\n            });\n\n            return data;\n        }\n\n        insertShortcode(data) {\n            var text = this.buildShortcode(data);\n            send_to_editor( text );\n        }\n\n        buildShortcode(data) {\n            var enclosingText = null;\n\n            if ( this.editor ) {\n                enclosingText = this.editor.selection.getContent();\n            }\n\n            var text = '[' + data.command;\n\n            if (data.params) {\n                for (var key in data.params) {\n                    text += ' ' + key + '=\"' + data.params[key] + '\"';\n                }\n            }\n\n            text += ']';\n\n            if ( enclosingText ) {\n                text += enclosingText + '[/' + data.command + ']';\n            }\n\n            return text;\n        }\n\n        onSubmitBtnClick(e) {\n            e.preventDefault();\n            var shortcode = this.$select.val();\n\n            var $fields = jQuery('.shortcode-' + shortcode).find('.wp-scif-field');\n\n            if ( this.validateForm() ) {\n                this.parseShortcode();\n            }\n        }\n\n        onSelectChanged(e) {\n            this.selectedShortcode = this.$select.val();\n\n            if ( this.selectedShortcode.length === 0 ) {\n                jQuery('#wp-scif-form-inner .active').removeClass('active');\n            }\n\n            jQuery('.shortcode-' + this.selectedShortcode).addClass('active');\n            this.initPreview();\n        }\n\n        initPreview() {\n            var data = this.getFormValues();\n\n            if (data.command){\n                var shortcode = this.buildShortcode(data);\n                // var stylesheet = jQuery('#' + this.selectedShortcode + '-preview').data('styles');\n                // var link  = jQuery('link').attr('href', stylesheet);\n                jQuery('head', window.frames[this.selectedShortcode + '-preview']).append('Hello world');\n                jQuery.getJSON(ajaxurl, {\n                    action: 'render_shortcode',\n                    shortcode: shortcode\n                }, (data) => {\n                    var ifrm = <any>document.getElementById(this.selectedShortcode + '-preview');\n                    \n                    ifrm = ifrm.contentWindow || ifrm.contentDocument.document || ifrm.contentDocument;\n                    ifrm.document.open();\n                    ifrm.document.write(data.markup);\n                    ifrm.document.close();\n                });   \n            }         \n        }\n    }\n}\n\nif ( typeof jQuery !== 'undefined' ) {\n    jQuery(document).ready( function() {\n        new WPSCIF.ShortcodeInterface();\n    });\n}\n"]}