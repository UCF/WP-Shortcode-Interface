{"version":3,"sources":["field.ts","text.ts","select.ts","date.ts","color.ts","checkbox.ts","fieldset.ts","wp-scif.ts"],"names":["WPSCIF","Fields","Field","$field","this","fieldID","attr","required","data","param","prototype","isValid","id","getValue","jQuery","addClass","removeClass","setDefaultValue","val","hasValue","getOutput","TextField","_super","_this","call","inputMask","__extends","RegExp","test","SelectField","options","Array","find","each","idx","obj","push","inArray","prop","DateField","ColorField","CheckboxField","is","FieldSet","command","$container","$description","allowContent","fields","createField","init","forEach","field","destroy","tagName","getFields","errorCount","getValues","retval","buildShortcode","text","outputArr","length","join","ShortcodeInterface","$toggle","$interface","$submitBtn","$select","activeFieldSet","editor","tinyMCE","activeEditor","click","e","onSubmitBtnClick","change","onSelectChanged","enclosingText","selection","getContent","insertShortcode","send_to_editor","preventDefault","sc","initPreview","shortcode","getJSON","ajaxurl","action","console","log","markup","document","ready"],"mappings":"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","file":"wp-scif.min.js","sourcesContent":["namespace WPSCIF.Fields {\n    export abstract class Field {\n        protected $field: any;\n        public required: boolean;\n        public param: string;\n        public default: string;\n        private fieldID: string;\n\n        constructor($field: any) {\n            this.$field = $field;\n            this.fieldID = this.$field.attr('id');\n            this.required = <boolean>this.$field.data('scif-required');\n            if (typeof this.required === \"undefined\") {\n                this.required = false;\n            }\n            this.param = this.$field.data('scif-param');\n            this.default = this.$field.data('scif-default');\n        }\n\n        public isValid(): boolean {\n            var id = '#' + this.fieldID + '-' + this.param + '-error';\n            // If required, it must have value\n            if (this.required && ! this.getValue()) {\n                jQuery(id).addClass('active');\n                return false;\n            }\n            jQuery(id).removeClass('active');\n            return true;\n        }\n\n        public setDefaultValue() {\n            if (this.default) {\n                this.$field.val(this.default);\n            } else {\n                this.$field.val('');\n            }\n        }\n\n        public hasValue() {\n            if (this.getValue()) {\n                return true;\n            }\n\n            return false;\n        }\n\n        public getValue() {\n            return this.$field.val();\n        }\n\n        public getOutput() {\n            return this.param + '=\"' + this.getValue() + '\"';\n        }\n    }\n}\n","namespace WPSCIF.Fields {\n    export class TextField extends Field {\n        inputMask: string;\n\n        constructor($field: any) {\n            super($field);\n            this.inputMask = this.$field.data('wpscif-valid-regex');\n        }\n\n        public isValid() : boolean {\n            var valid = super.isValid();\n\n            var pattern = new RegExp(this.inputMask);\n            var valid = pattern.test(this.getValue());\n\n            return valid;\n        }\n    }\n}\n","namespace WPSCIF.Fields {\n    export class SelectField extends Field {\n        options: Array<string>;\n\n        constructor($field: any) {\n            super($field)\n            this.options = new Array<string>();\n            this.$field.find('option').each( (idx, obj) => {\n                this.options.push(jQuery(obj).val());\n            });\n        }\n\n        public setDefaultValue() {\n            if (this.default) {\n                this.$field.val(this.default);\n            } else if (jQuery.inArray('', this.options) > -1) {\n                this.$field.val('');\n            } else {\n                this.$field.find('option:selected').prop('selected', false);\n                this.$field.find('option:first').prop('selected', 'selected');\n            }\n        }\n    }\n}\n","namespace WPSCIF.Fields {\n    export class DateField extends Field {\n        inputMask: string;\n\n        constructor($field: any) {\n            super($field);\n        }\n    }\n}\n","namespace WPSCIF.Fields {\n    export class ColorField extends Field {\n        constructor($field: any) {\n            super($field);\n        }\n    }\n}\n","namespace WPSCIF.Fields {\n    export class CheckboxField extends Field {\n        constructor($field: any) {\n            super($field);\n        }\n\n        public getValue() {\n            return this.$field.is(':checked');\n        }\n\n        public setDefaultValue() {\n            if (this.default !== null ) {\n                this.$field.prop('checked', true);\n            } else {\n                this.$field.prop('checked', false);\n            }\n        }\n    }\n}\n","/// <reference path=\"./fields/fields.d.ts\" />\n\nnamespace WPSCIF {\n    export class FieldSet {\n        private command: string;\n        private fields: Array<Fields.Field>;\n        private $container: any;\n        private $description: any;\n        public allowContent: boolean;\n        \n        constructor(command) {\n            this.command = command;\n            this.$container = jQuery('.shortcode-editor.shortcode-' + command);\n            this.$description = jQuery('.shortcode-desc.shortcode-' + this.command);\n            this.allowContent = this.$container.is('[data-scif-allows-content]');\n            this.fields = new Array<Fields.Field>();\n            var $fields = this.$container.find('.wp-scif-field');\n\n            $fields.each( (idx, obj) => {\n                var $field = jQuery(obj);\n                this.fields.push(this.createField(obj));\n            });\n\n            this.init();\n        }\n\n        private init() {\n            this.fields.forEach( (field) => {\n                field.setDefaultValue();\n            });\n\n            this.$container.addClass('active');\n            this.$description.addClass('active');\n        }\n\n        public destroy() {\n            this.$container.removeClass('active');\n            this.$description.removeClass('active');\n        }\n\n        private createField(obj) {\n            var $field = jQuery(obj),\n                tagName = $field.prop('tagName');\n\n            if (tagName === 'SELECT') {\n                return new Fields.SelectField($field);\n            } else if (tagName === 'INPUT') {\n                var type = $field.attr('type');\n                switch(type) {\n                    case 'text':\n                        return new Fields.TextField($field);\n                    case 'date':\n                        return new Fields.DateField($field);\n                    case 'checkbox':\n                        return new Fields.CheckboxField($field);\n                    default:\n                        return new Fields.TextField($field);\n                }\n            }\n        }\n\n        public getFields() {\n            return this.fields;\n        }\n\n        public isValid() {\n            var errorCount: number = 0;\n\n            this.fields.forEach( (field) => {\n                if (!field.isValid) {\n                    errorCount++;\n                }\n            });\n\n            if (errorCount > 0) {\n                return false;\n            }\n\n            return true;\n        }\n\n        public getValues() {\n            var retval = Array<string>();\n\n            this.fields.forEach( (field) => {\n                if (field.hasValue()) {\n                    retval.push(field.getOutput());\n                }\n            });\n\n            return retval;\n        }\n\n        public buildShortcode(text='') {\n            var retval = '[' + this.command;\n            var outputArr = this.getValues();\n            \n            if (outputArr.length > 0) {\n                retval += ' ' + outputArr.join(' ') + ']';\n            }\n\n            if (text) {\n                retval += text;\n            }\n\n            if (this.allowContent) {\n                retval += '[/' + this.command + ']';\n            }\n\n            return retval;\n        }\n    }\n}\n","/// <reference path=\"./wp-scif.d.ts\" />\n\ndeclare var tinyMCE: any;\ndeclare var send_to_editor: Function;\ndeclare var ajaxurl: string;\n\nnamespace WPSCIF {\n    export class ShortcodeInterface {\n        public $toggle: any;\n        public $interface: any;\n        public $submitBtn: any;\n        public $select: any;\n        public activeFieldSet: FieldSet;\n        public editor: any;\n\n        constructor() {\n            this.$toggle = jQuery('#add-shortcode');\n            this.$interface = jQuery('#wp-scif-form-inner');\n            this.$submitBtn = this.$interface.find('#wp-scif-submit');\n            this.$select = this.$interface.find('#wp-scif-select');\n            this.activeFieldSet = null;\n            this.editor = tinyMCE.activeEditor;\n\n            this.$submitBtn.click( (e) => { this.onSubmitBtnClick(e) });\n            this.$select.change( (e) => { this.onSelectChanged(e) });\n        }\n\n        buildShortcode() {\n            var enclosingText = null;\n\n            if (this.editor) {\n                enclosingText = this.editor.selection.getContent();\n            }\n\n            return this.activeFieldSet.buildShortcode(enclosingText);\n        }\n\n        insertShortcode() {\n            var text = this.buildShortcode();\n            send_to_editor( text );\n        }\n\n        onSubmitBtnClick(e) {\n            e.preventDefault();\n\n            if ( this.activeFieldSet.isValid() ) {\n                this.insertShortcode();\n            }\n        }\n\n        onSelectChanged(e) {\n            if (this.activeFieldSet) {\n                this.activeFieldSet.destroy();\n            }\n\n            var sc = this.$select.val();\n\n            this.activeFieldSet = new FieldSet(sc);\n\n            this.initPreview();\n        }\n\n        initPreview() {\n            var shortcode = this.buildShortcode();\n            jQuery.getJSON(ajaxurl, {\n                action: 'render_shortcode',\n                shortcode: shortcode\n            }, function(data) {\n                console.log(data.markup);\n            });\n        }\n    }\n}\n\nif ( typeof jQuery !== 'undefined' ) {\n    jQuery(document).ready( function() {\n        new WPSCIF.ShortcodeInterface();\n    });\n}\n"]}