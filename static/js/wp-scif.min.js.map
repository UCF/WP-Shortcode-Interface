{"version":3,"sources":["wp-scif.ts"],"names":["WPSCIF","ShortcodeInterface","_this","this","$toggle","jQuery","$interface","$submitBtn","find","$select","selectedShortcode","$activeShortcodeEditor","$activeShortcodeDescription","$activeFields","click","e","resetForm","onSubmitBtnClick","change","onSelectChanged","prototype","editor","tinyMCE","activeEditor","val","trigger","prop","each","i","field","$field","validateForm","errors","name","data","addClass","removeClass","parseShortcode","getFormValues","insertShortcode","command","params","allowsContent","undefined","param","value","hasClass","String","text","buildShortcode","send_to_editor","enclosingText","selection","getContent","key","preventDefault","$activeShortcodeElems","filter","initPreview","shortcode","getJSON","ajaxurl","action","ifrm","document","getElementById","contentWindow","contentDocument","open","write","markup","close","ready"],"mappings":"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","file":"wp-scif.min.js","sourcesContent":["declare var tinyMCE: any;\ndeclare var send_to_editor: Function;\ndeclare var ajaxurl: string;\n\nnamespace WPSCIF {\n    export class ShortcodeInterface {\n        public $toggle: any;\n        public $interface: any;\n        public $submitBtn: any;\n        public $select: any;\n        public selectedShortcode: string;\n        public $activeShortcodeEditor: any;\n        public $activeShortcodeDescription: any;\n        public $activeFields: any;\n        public editor: any;\n\n        constructor() {\n            this.$toggle = jQuery('#add-shortcode');\n            this.$interface = jQuery('#wp-scif-form-inner');\n            this.$submitBtn = this.$interface.find('#wp-scif-submit');\n            this.$select = this.$interface.find('#wp-scif-select');\n            this.selectedShortcode = null;\n            this.$activeShortcodeEditor = null;\n            this.$activeShortcodeDescription = null;\n            this.$activeFields = null;\n\n            this.$toggle.click( (e) => { this.resetForm() } );\n            this.$submitBtn.click( (e) => { this.onSubmitBtnClick(e) });\n            this.$select.change( (e) => { this.onSelectChanged(e) });\n        }\n\n        resetForm() {\n            this.editor = tinyMCE.activeEditor ? tinyMCE.activeEditor : null;\n            this.$select.val('').trigger('change');\n            if (this.$activeFields) {\n                this.$activeFields.prop('checked', false);\n                this.$activeFields.each( (i, field) => {\n                    var $field = jQuery(field);\n                    if ( $field.prop['type'] !== 'checkbox' ) {\n                        $field.val('');\n                    }\n                });\n            }\n        }\n\n        validateForm() : boolean {\n            var errors = 0;\n\n            if (this.$activeFields) {\n                this.$activeFields.each( (i, field) => {\n                    var $field = jQuery(field),\n                        name = $field.data('scif-param'),\n                        required = $field.data('scif-required');\n\n                    if ( required && ( $field.val() === '' ) ) {\n                        jQuery( '.' + name + '-error' ).addClass('active');\n                        errors++;\n                    } else {\n                        jQuery( '.' + name + '-error' ).removeClass('active');\n                    }\n                } );\n            }\n            else {\n                errors++;\n            }\n\n            if ( errors ) {\n                return false;\n            }\n\n            return true;\n        }\n\n        parseShortcode() {\n            var data = this.getFormValues();\n            this.insertShortcode(data);\n        }\n\n        getFormValues() {\n            var data = {\n                command: this.selectedShortcode,\n                params: {},\n                allowsContent: this.$activeShortcodeEditor.data('scif-allows-content') !== undefined\n            };\n\n            this.$activeFields.each( (i, field) => {\n                var $field = jQuery(field),\n                    param  = $field.data('scif-param'),\n                    value  = '';\n\n                switch( $field.prop('tagName') ) {\n                    case 'INPUT':\n                    case 'TEXTAREA':\n                    case 'SELECT':\n                        if ($field.prop('type') === 'checkbox') {\n                            if ( $field.hasClass( 'checkbox-list-item' ) ) {\n                                if ( $field.prop('checked') ) {\n                                    value = $field.val();\n                                } else {\n                                    break;\n                                }\n                            } else {\n                                value = String($field.prop('checked'));\n                            }\n                        } else {\n                            value = $field.val();\n                        }\n                        break;\n                    default:\n                        value = $field.val();\n                }\n\n                if (value) {\n                    if (typeof data.params[param] !== 'undefined') {\n                        data.params[param] += ',' + value;\n                    } else {\n                        data.params[param] = value;\n                    }\n                }\n            });\n\n            return data;\n        }\n\n        insertShortcode(data) {\n            var text = this.buildShortcode(data);\n            send_to_editor( text );\n        }\n\n        buildShortcode(data) {\n            var enclosingText = null;\n\n            if ( this.editor ) {\n                enclosingText = this.editor.selection.getContent();\n            }\n\n            var text = '[' + data.command;\n\n            if (data.params) {\n                for (var key in data.params) {\n                    text += ' ' + key + '=\"' + data.params[key] + '\"';\n                }\n            }\n\n            text += ']';\n\n            if ( enclosingText ) {\n                text += enclosingText;\n            }\n            if ( data.allowsContent ) {\n                text += '[/' + data.command + ']';\n            }\n\n            return text;\n        }\n\n        onSubmitBtnClick(e) {\n            e.preventDefault();\n\n            if ( this.validateForm() ) {\n                this.parseShortcode();\n            }\n        }\n\n        onSelectChanged(e) {\n            this.selectedShortcode = this.$select.val();\n\n            if (this.$activeShortcodeEditor) {\n                this.$activeShortcodeEditor.removeClass('active');\n            }\n            if (this.$activeShortcodeDescription) {\n                this.$activeShortcodeDescription.removeClass('active');\n            }\n\n            // $activeShortcodeElems references both the shortcode editor and\n            // the shortcode description\n            var $activeShortcodeElems = this.$interface.find('.shortcode-' + this.selectedShortcode).addClass('active');\n            this.$activeShortcodeEditor = $activeShortcodeElems.filter('.shortcode-editor');\n            this.$activeShortcodeDescription = $activeShortcodeElems.filter('.shortcode-desc');\n            this.$activeFields = this.$activeShortcodeEditor.find('.wp-scif-field');\n\n            this.initPreview();\n        }\n\n        initPreview() {\n            var data = this.getFormValues();\n\n            if (data.command) {\n                var shortcode = this.buildShortcode(data);\n\n                jQuery.getJSON(ajaxurl, {\n                    action: 'render_shortcode',\n                    shortcode: shortcode\n                }, (data) => {\n                    var ifrm = <any>document.getElementById(this.selectedShortcode + '-preview');\n                    ifrm = ifrm.contentWindow || ifrm.contentDocument.document || ifrm.contentDocument;\n                    ifrm.document.open();\n                    ifrm.document.write(data.markup);\n                    ifrm.document.close();\n                });\n            }\n        }\n    }\n}\n\nif ( typeof jQuery !== 'undefined' ) {\n    jQuery(document).ready( function() {\n        new WPSCIF.ShortcodeInterface();\n    });\n}\n"]}